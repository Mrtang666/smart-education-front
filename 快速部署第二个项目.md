# 快速部署第二个前端项目

## 🚀 一键部署（推荐）

### Windows用户
```powershell
# 在项目根目录执行
.\deploy-second-project.ps1 -ProjectName "你的项目名" -LocalDistPath "D:\path\to\your\project\dist"
```

### Linux/Mac用户
```bash
# 给脚本执行权限
chmod +x deploy-second-project.sh

# 修改脚本中的配置变量后执行
./deploy-second-project.sh
```

---

## 📋 手动部署步骤

### 1. 服务器准备
```bash
# SSH连接到服务器
ssh root@118.89.136.119

# 创建目录
sudo mkdir -p /projects/frontend2/dist
sudo mkdir -p /projects/nginx/conf.d
sudo chown -R www-data:www-data /projects/frontend2
sudo chmod -R 755 /projects/frontend2
```

### 2. 重新配置nginx容器
```bash
# 停止现有容器
docker stop nginx-frontend
docker rm nginx-frontend

# 创建多项目nginx容器
docker run -d \
  --name nginx-multi-frontend \
  -p 8080:80 \
  -p 8081:8081 \
  -v /projects/frontend/dist:/usr/share/nginx/html/project1 \
  -v /projects/frontend2/dist:/usr/share/nginx/html/project2 \
  -v /projects/nginx/conf.d:/etc/nginx/conf.d \
  nginx:latest
```

### 3. 上传项目文件
```powershell
# Windows PowerShell（在本地执行）
scp -r "D:\path\to\your\second-project\dist\*" root@118.89.136.119:/projects/frontend2/dist/
```

### 4. 访问项目
- 第一个项目：http://118.89.136.119:8080
- 第二个项目：http://118.89.136.119:8081

---

## 🔄 日常更新流程

### 更新第一个项目（smart-education-front）
```powershell
# 本地构建
npm run build

# 上传
scp -r "D:\git depository\smart-education-front\dist\*" root@118.89.136.119:/projects/frontend/dist/
```

### 更新第二个项目
```powershell
# 本地构建
npm run build

# 上传
scp -r "D:\path\to\your\second-project\dist\*" root@118.89.136.119:/projects/frontend2/dist/
```

---

## 🛠️ 常用命令

### 查看容器状态
```bash
docker ps | grep nginx
```

### 查看nginx日志
```bash
docker logs nginx-multi-frontend
```

### 重启nginx
```bash
docker restart nginx-multi-frontend
```

### 进入容器调试
```bash
docker exec -it nginx-multi-frontend /bin/bash
```

### 检查文件是否上传成功
```bash
# 检查第一个项目
ls -la /projects/frontend/dist/

# 检查第二个项目
ls -la /projects/frontend2/dist/
```

---

## ⚠️ 注意事项

1. **端口冲突**：确保8080和8081端口未被占用
2. **文件权限**：上传后检查文件权限是否正确
3. **缓存问题**：如果页面未更新，尝试强制刷新（Ctrl+F5）
4. **路径配置**：确保本地项目路径正确
5. **网络连接**：确保能正常SSH连接到服务器

---

## 🔧 故障排除

### 问题1：容器启动失败
```bash
# 查看错误日志
docker logs nginx-multi-frontend

# 检查端口占用
netstat -tlnp | grep :8080
netstat -tlnp | grep :8081
```

### 问题2：页面404错误
```bash
# 检查文件是否存在
docker exec nginx-multi-frontend ls -la /usr/share/nginx/html/project1/
docker exec nginx-multi-frontend ls -la /usr/share/nginx/html/project2/

# 检查nginx配置
docker exec nginx-multi-frontend nginx -t
```

### 问题3：文件上传失败
```bash
# 检查目录权限
ls -la /projects/

# 修复权限
sudo chown -R www-data:www-data /projects/frontend2
sudo chmod -R 755 /projects/frontend2
```

---

## 📁 项目结构

部署完成后的服务器目录结构：
```
/projects/
├── frontend/          # 第一个项目
│   └── dist/
│       ├── index.html
│       ├── css/
│       └── js/
├── frontend2/         # 第二个项目
│   └── dist/
│       ├── index.html
│       ├── css/
│       └── js/
└── nginx/
    └── conf.d/
        ├── project1.conf
        └── project2.conf
```